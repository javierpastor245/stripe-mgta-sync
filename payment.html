<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Pago Erasmus</title>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 40px;
        text-align: center;
        background-color: #fff;
      }

      h2 {
        color: #111;
        font-size: 24px;
        margin-bottom: 20px;
      }

      #express-checkout-element {
        margin: 40px auto;
        max-width: 400px;
      }

      #payment-status {
        margin-top: 20px;
        font-weight: bold;
        color: green;
      }
    </style>
  </head>
  <body>
    <h2>Selecciona tu m√©todo de pago</h2>
    <div id="express-checkout-element"></div>
    <div id="payment-status"></div>

    <script>
      const stripe = Stripe("pk_test_51QS7QPGmMy7u2HjHPMq2xgzDY6bbfN4lXoFMYC8sNBOCuW8X5n79Wq3wZQ7cCx9ROQSEVgkt7mHSixXY9GTMzVJx00KDvBwdC");

      const datosUsuario = {
        nombre: localStorage.getItem("nombre") || "Nombre Prueba",
        email: localStorage.getItem("email") || "email@prueba.com",
        discoteca: localStorage.getItem("discoteca") || "Akuarela",
        fecha: localStorage.getItem("fecha") || "2025-06-01",
        pax: parseInt(localStorage.getItem("pax") || "1")
      };

      async function init() {
        try {
          const res = await fetch("/crear-intento", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(datosUsuario)
          });

          const { clientSecret } = await res.json();

          const appearance = {
            theme: 'stripe',
            variables: {
              borderRadius: '8px',
              colorPrimary: '#b72218'
            }
          };

          const expressCheckoutOptions = {
            buttonHeight: 50,
            buttonTheme: {
              applePay: 'black',
              googlePay: 'dark'
            }
          };

          const elements = stripe.elements({
            clientSecret,
            appearance
          });

          const expressCheckoutElement = elements.create('expressCheckout', expressCheckoutOptions);
          expressCheckoutElement.mount('#express-checkout-element');
        } catch (error) {
          document.getElementById("payment-status").textContent = "Error al inicializar el pago.";
          console.error("Stripe init error:", error);
        }
      }

      init();
    </script>
  </body>
</html>